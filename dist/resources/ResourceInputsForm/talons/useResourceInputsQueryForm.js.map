{"version":3,"file":"useResourceInputsQueryForm.js","names":["_react","require","_useForm","_interopRequireDefault","_config","_lodash","_helpers","obj","__esModule","default","defaultRefetchVariables","input","pagination","page","limit","useResourceInputsQueryForm","_ref","extraFormCruds","item","handleCloseQueryContainer","saveLabel","createLabel","initialValues","createQuery","updateQuery","id","loading","parentType","refetchDocument","useMemo","queryOptions","refetchQueries","query","variables","createValue","createLoading","updateValue","updateLoading","onSubmitInputs","useCallback","val","data","removeExtraFormItemId","getCorrectExtraFormSubmitValues","formOptions","valuesForEdit","onSubmitMethod","handleSubmit","setFieldValue","formValues","formHandler","useForm","useEffect","LOYALTY_LEVEL","type","LOYALTY_LEVEL_REWARD_TYPES","BONUS","has","BONUS_ID","bonusId","undefined","CASHBACK","CASHBACK_PERCENT","cashbackPercent","DEPOSIT_LIMIT","depositLimit","WITHDRAW_LIMIT","withdrawLimit","parsedValues","Object","keys","map","field","value","arrayOfValues","pv","TYPE","_dropdownTypeValues$f","dropdownTypeValues","LoyaltyRewardTypeEnums","key","name","code","activeValue","find","_pv$value","isFloat","toString","LOYALITY_LEVEL_ID","isDisabled","handleChangeField","submitLocale","_default","exports"],"sources":["../../../../src/resources/ResourceInputsForm/talons/useResourceInputsQueryForm.ts"],"sourcesContent":["import { useCallback, useEffect, useMemo } from \"react\";\nimport type { CrudType } from \"../models/CrudType\";\nimport { FieldsType } from \"../models/FieldsType\";\nimport useForm from \"../../ResourceForm/talons/useForm\";\nimport {\n  BONUS_ID,\n  CASHBACK_PERCENT,\n  DEPOSIT_LIMIT,\n  LOYALITY_LEVEL_ID,\n  LOYALTY_LEVEL,\n  LOYALTY_LEVEL_REWARD_TYPES,\n  LoyaltyRewardTypeEnums,\n  TYPE,\n  WITHDRAW_LIMIT,\n} from \"../config\";\nimport { has } from \"lodash\";\nimport {\n  getCorrectExtraFormSubmitValues,\n  removeExtraFormItemId,\n} from \"../helpers\";\n\ninterface UseResourceInputsQueryForm {\n  extraFormCruds: CrudType;\n  item?: any;\n  handleCloseQueryContainer?: () => void;\n  saveLabel?: string;\n  createLabel?: string;\n}\n\nconst defaultRefetchVariables = {\n  input: {\n    pagination: {\n      page: 0,\n      limit: 10,\n    },\n  },\n};\n\nconst useResourceInputsQueryForm = ({\n  extraFormCruds,\n  item,\n  handleCloseQueryContainer,\n  saveLabel,\n  createLabel,\n}: UseResourceInputsQueryForm) => {\n  const {\n    initialValues,\n    createQuery,\n    updateQuery,\n    id,\n    loading,\n    parentType,\n    refetchDocument,\n  } = useMemo(() => extraFormCruds || {}, [extraFormCruds]);\n\n  const queryOptions = refetchDocument\n    ? {\n        refetchQueries: [\n          { query: refetchDocument, variables: defaultRefetchVariables },\n        ],\n      }\n    : null;\n\n  const [createValue, { loading: createLoading }] = createQuery(queryOptions);\n  const [updateValue, { loading: updateLoading }] = updateQuery(queryOptions);\n\n  const onSubmitInputs = useCallback(\n    (val: any) => {\n      if (item) {\n        updateValue({\n          variables: {\n            input: {\n              id: item?.id,\n              data: removeExtraFormItemId(\n                getCorrectExtraFormSubmitValues(val, parentType),\n                parentType\n              ),\n            },\n          },\n        });\n      } else {\n        createValue({\n          variables: {\n            input: getCorrectExtraFormSubmitValues(val, parentType),\n          },\n        });\n      }\n\n      if (handleCloseQueryContainer) {\n        handleCloseQueryContainer();\n      }\n    },\n    [updateValue, createValue, item, id, handleCloseQueryContainer, parentType]\n  );\n\n  const formOptions = useMemo(\n    () =>\n      item\n        ? {\n            valuesForEdit: item,\n            onSubmitMethod: onSubmitInputs,\n            loading,\n          }\n        : {\n            initialValues,\n            onSubmitMethod: onSubmitInputs,\n          },\n    [initialValues, item, loading, onSubmitInputs]\n  );\n\n  const { handleSubmit, setFieldValue, formValues, formHandler } =\n    useForm(formOptions);\n\n  useEffect(() => {\n    if (parentType && parentType === LOYALTY_LEVEL) {\n      if (\n        formValues?.type === LOYALTY_LEVEL_REWARD_TYPES.BONUS &&\n        !has(formValues, BONUS_ID)\n      ) {\n        formHandler.setFieldValue(BONUS_ID, item?.bonusId || \"\");\n      } else if (\n        formValues?.type !== LOYALTY_LEVEL_REWARD_TYPES.BONUS &&\n        has(formValues, BONUS_ID)\n      ) {\n        formHandler.setFieldValue(BONUS_ID, undefined);\n      }\n\n      if (\n        formValues?.type === LOYALTY_LEVEL_REWARD_TYPES.CASHBACK &&\n        !has(formValues, CASHBACK_PERCENT)\n      ) {\n        formHandler.setFieldValue(\n          CASHBACK_PERCENT,\n          item?.cashbackPercent || \"\"\n        );\n      } else if (\n        formValues?.type !== LOYALTY_LEVEL_REWARD_TYPES.CASHBACK &&\n        has(formValues, CASHBACK_PERCENT)\n      ) {\n        formHandler.setFieldValue(CASHBACK_PERCENT, undefined);\n      }\n\n      if (\n        formValues?.type === LOYALTY_LEVEL_REWARD_TYPES.DEPOSIT_LIMIT &&\n        !has(formValues, DEPOSIT_LIMIT)\n      ) {\n        formHandler.setFieldValue(DEPOSIT_LIMIT, item?.depositLimit || \"\");\n      } else if (\n        formValues?.type !== LOYALTY_LEVEL_REWARD_TYPES.DEPOSIT_LIMIT &&\n        has(formValues, DEPOSIT_LIMIT)\n      ) {\n        formHandler.setFieldValue(DEPOSIT_LIMIT, undefined);\n      }\n\n      if (\n        formValues?.type === LOYALTY_LEVEL_REWARD_TYPES.WITHDRAW_LIMIT &&\n        !has(formValues, WITHDRAW_LIMIT)\n      ) {\n        formHandler.setFieldValue(WITHDRAW_LIMIT, item?.withdrawLimit || \"\");\n      } else if (\n        formValues?.type !== LOYALTY_LEVEL_REWARD_TYPES.WITHDRAW_LIMIT &&\n        has(formValues, WITHDRAW_LIMIT)\n      ) {\n        formHandler.setFieldValue(WITHDRAW_LIMIT, undefined);\n      }\n    }\n  }, [\n    parentType,\n    formValues,\n    item?.bonusId,\n    item?.cashbackPercent,\n    item?.depositLimit,\n    item?.withdrawLimit,\n  ]);\n\n  const parsedValues = useMemo(\n    () =>\n      Object.keys(formValues).map((field) => ({\n        field,\n        value: formValues[field],\n      })),\n    [formValues]\n  );\n\n  const arrayOfValues = useMemo(\n    () =>\n      parsedValues.map((pv) => {\n        if (parentType === LOYALTY_LEVEL) {\n          if (pv.field === TYPE) {\n            const dropdownTypeValues = Object.keys(LoyaltyRewardTypeEnums).map(\n              (key) => ({\n                name: key,\n                // @ts-ignore\n                code: LoyaltyRewardTypeEnums[key],\n              })\n            );\n\n            return {\n              ...pv,\n              ...(item\n                ? {\n                    activeValue: {\n                      // @ts-ignore\n                      name: dropdownTypeValues.find(\n                        (value) => value.code === pv.value\n                      )?.name,\n                      code: pv.value,\n                    },\n                  }\n                : null),\n              value: dropdownTypeValues,\n            };\n          } else if (\n            pv.field === CASHBACK_PERCENT ||\n            pv.field === DEPOSIT_LIMIT ||\n            pv.field === WITHDRAW_LIMIT\n          ) {\n            return item\n              ? {\n                  ...pv,\n                  isFloat: true,\n                  value:\n                    typeof pv.value === \"string\"\n                      ? pv.value\n                      : pv.value?.toString() || \"\",\n                }\n              : {\n                  ...pv,\n                  isFloat: true,\n                };\n          } else if (pv.field === LOYALITY_LEVEL_ID) {\n            return {\n              ...item,\n              isDisabled: true,\n            };\n          }\n        }\n\n        return pv;\n      }),\n    [parsedValues, parentType, item]\n  ) as FieldsType[];\n\n  const handleChangeField = useCallback(\n    (value: string | number | boolean, field: string) => {\n      setFieldValue(field, value);\n    },\n    [setFieldValue]\n  );\n\n  const submitLocale = useMemo(\n    () => (item ? saveLabel : createLabel),\n    [item, saveLabel, createLabel]\n  );\n\n  return {\n    loading: createLoading || updateLoading,\n    handleSubmit,\n    arrayOfValues,\n    handleChangeField,\n    submitLocale,\n  };\n};\n\nexport default useResourceInputsQueryForm;\n"],"mappings":"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"}