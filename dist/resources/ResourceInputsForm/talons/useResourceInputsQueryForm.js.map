{"version":3,"file":"useResourceInputsQueryForm.js","names":["_react","require","_useForm","_interopRequireDefault","_helpers","obj","__esModule","default","defaultRefetchVariables","input","pagination","page","limit","useResourceInputsQueryForm","_ref","extraFormCruds","item","handleCloseQueryContainer","saveLabel","createLabel","initialValues","dynamicalInputs","createQuery","updateQuery","id","loading","parentType","refetchDocument","externalValues","useMemo","queryOptions","refetchQueries","query","variables","createValue","createLoading","updateValue","updateLoading","onSubmitInputs","useCallback","val","update","removeExtraFormItemId","getCorrectExtraFormSubmitValues","formOptions","valuesForEdit","onSubmitMethod","handleSubmit","setFieldValue","formValues","formHandler","useForm","useEffect","prepareDynamicalFieldsByFormType","parsedValues","Object","keys","map","field","value","arrayOfValues","pv","customizeFieldInputs","console","log","handleChangeField","submitLocale","_default","exports"],"sources":["../../../../src/resources/ResourceInputsForm/talons/useResourceInputsQueryForm.ts"],"sourcesContent":["import { useCallback, useEffect, useMemo } from \"react\";\nimport type { CrudType } from \"../models/CrudType\";\nimport useForm from \"../../ResourceForm/talons/useForm\";\nimport {\n  customizeFieldInputs,\n  getCorrectExtraFormSubmitValues,\n  prepareDynamicalFieldsByFormType,\n  removeExtraFormItemId,\n} from \"../helpers\";\nimport { FieldsType } from \"../models/FieldsType\";\n\ninterface UseResourceInputsQueryForm {\n  extraFormCruds: CrudType;\n  item?: any;\n  handleCloseQueryContainer?: () => void;\n  saveLabel?: string;\n  createLabel?: string;\n}\n\nconst defaultRefetchVariables = {\n  input: {\n    pagination: {\n      page: 0,\n      limit: 10,\n    },\n  },\n};\n\nconst useResourceInputsQueryForm = ({\n  extraFormCruds,\n  item,\n  handleCloseQueryContainer,\n  saveLabel,\n  createLabel,\n}: UseResourceInputsQueryForm) => {\n  const {\n    initialValues,\n    dynamicalInputs,\n    createQuery,\n    updateQuery,\n    id,\n    loading,\n    parentType,\n    refetchDocument,\n    externalValues,\n  } = useMemo(() => extraFormCruds || {}, [extraFormCruds]);\n\n  const queryOptions = refetchDocument\n    ? {\n        refetchQueries: [\n          { query: refetchDocument, variables: defaultRefetchVariables },\n        ],\n      }\n    : null;\n\n  const [createValue, { loading: createLoading }] = createQuery(queryOptions);\n  const [updateValue, { loading: updateLoading }] = updateQuery(queryOptions);\n\n  const onSubmitInputs = useCallback(\n    (val: any) => {\n      if (item) {\n        updateValue({\n          variables: {\n            input: {\n              id: item?.id,\n              update: removeExtraFormItemId(\n                getCorrectExtraFormSubmitValues(val, parentType),\n                parentType\n              ),\n            },\n          },\n        });\n      } else {\n        createValue({\n          variables: {\n            input: getCorrectExtraFormSubmitValues(val, parentType),\n          },\n        });\n      }\n\n      if (handleCloseQueryContainer) {\n        handleCloseQueryContainer();\n      }\n    },\n    [updateValue, createValue, item, handleCloseQueryContainer, parentType]\n  );\n\n  const formOptions = useMemo(\n    () =>\n      item\n        ? {\n            valuesForEdit: item,\n            onSubmitMethod: onSubmitInputs,\n            loading,\n          }\n        : {\n            initialValues,\n            onSubmitMethod: onSubmitInputs,\n          },\n    [initialValues, item, loading, onSubmitInputs]\n  );\n\n  const { handleSubmit, setFieldValue, formValues, formHandler } =\n    useForm(formOptions);\n\n  // Handle dynamical fields for some forms\n  useEffect(() => {\n    prepareDynamicalFieldsByFormType({\n      parentType,\n      dynamicalInputs,\n      formHandler,\n      formValues,\n      item,\n    });\n  }, [parentType, formValues, dynamicalInputs, item]);\n\n  const parsedValues = useMemo(\n    () =>\n      Object.keys(formValues).map((field) => ({\n        field,\n        value: formValues[field],\n      })),\n    [formValues]\n  );\n\n  const arrayOfValues = useMemo(\n    () =>\n      parsedValues.map((pv) =>\n        customizeFieldInputs({ pv, parentType, item, externalValues })\n      ),\n    [parsedValues, parentType, item, externalValues]\n  ) as FieldsType[];\n\n  console.log(arrayOfValues);\n  const handleChangeField = useCallback(\n    (value: string | number | boolean, field: string) => {\n      setFieldValue(field, value);\n    },\n    [setFieldValue]\n  );\n\n  const submitLocale = useMemo(\n    () => (item ? saveLabel : createLabel),\n    [item, saveLabel, createLabel]\n  );\n\n  return {\n    loading: createLoading || updateLoading,\n    handleSubmit,\n    arrayOfValues,\n    handleChangeField,\n    submitLocale,\n  };\n};\n\nexport default useResourceInputsQueryForm;\n"],"mappings":"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"}