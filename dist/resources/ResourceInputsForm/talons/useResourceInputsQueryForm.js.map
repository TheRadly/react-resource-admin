{"version":3,"file":"useResourceInputsQueryForm.js","names":["_react","require","_useForm","_interopRequireDefault","_helpers","_config","obj","__esModule","default","defaultRefetchVariables","input","pagination","page","limit","useResourceInputsQueryForm","_ref","extraFormCruds","item","handleCloseQueryContainer","saveLabel","createLabel","initialValues","dynamicalInputs","createQuery","updateQuery","loading","parentType","refetchDocument","successAction","externalValues","useMemo","queryOptions","refetchQueries","query","variables","createValue","createLoading","updateValue","updateLoading","onSubmitInputs","useCallback","val","id","update","removeExtraFormItemId","getCorrectExtraFormSubmitValues","onCompleted","args","formOptions","valuesForEdit","onSubmitMethod","handleSubmit","setFieldValue","formValues","formHandler","useForm","useEffect","prepareDynamicalFieldsByFormType","parsedValues","Object","keys","map","field","value","arrayOfValues","filter","pvFilter","DISABLED_IDS","includes","pv","customizeFieldInputs","handleChangeField","submitLocale","_default","exports"],"sources":["../../../../src/resources/ResourceInputsForm/talons/useResourceInputsQueryForm.ts"],"sourcesContent":["import { useCallback, useEffect, useMemo } from \"react\";\nimport type { CrudType } from \"../models/CrudType\";\nimport useForm from \"../../ResourceForm/talons/useForm\";\nimport {\n  customizeFieldInputs,\n  getCorrectExtraFormSubmitValues,\n  prepareDynamicalFieldsByFormType,\n  removeExtraFormItemId,\n} from \"../helpers\";\nimport { FieldsType } from \"../models/FieldsType\";\nimport { DISABLED_IDS } from \"../config\";\n\ninterface UseResourceInputsQueryForm {\n  extraFormCruds: CrudType;\n  item?: any;\n  handleCloseQueryContainer?: () => void;\n  saveLabel?: string;\n  createLabel?: string;\n}\n\nconst defaultRefetchVariables = {\n  input: {\n    pagination: {\n      page: 0,\n      limit: 100,\n    },\n  },\n};\n\nconst useResourceInputsQueryForm = ({\n  extraFormCruds,\n  item,\n  handleCloseQueryContainer,\n  saveLabel,\n  createLabel,\n}: UseResourceInputsQueryForm) => {\n  const {\n    initialValues,\n    dynamicalInputs,\n    createQuery,\n    updateQuery,\n    loading,\n    parentType,\n    refetchDocument,\n    successAction,\n    externalValues,\n  } = useMemo(() => extraFormCruds || {}, [extraFormCruds]);\n\n  const queryOptions = useMemo(\n    () =>\n      refetchDocument\n        ? {\n            refetchQueries: [\n              { query: refetchDocument, variables: defaultRefetchVariables },\n            ],\n          }\n        : null,\n    [refetchDocument]\n  );\n\n  const [createValue, { loading: createLoading }] = createQuery(queryOptions);\n  const [updateValue, { loading: updateLoading }] = updateQuery(queryOptions);\n\n  const onSubmitInputs = useCallback(\n    (val: any) => {\n      if (item) {\n        updateValue({\n          variables: {\n            input: {\n              id: item?.id,\n              update: removeExtraFormItemId(\n                getCorrectExtraFormSubmitValues(val, parentType),\n                parentType\n              ),\n            },\n          },\n          onCompleted: (args: any) => {\n            if (successAction) successAction(args);\n          },\n        });\n      } else {\n        createValue({\n          variables: {\n            input: getCorrectExtraFormSubmitValues(val, parentType),\n          },\n          onCompleted: (args: any) => {\n            if (successAction) successAction(args);\n          },\n        });\n      }\n\n      if (handleCloseQueryContainer) {\n        handleCloseQueryContainer();\n      }\n    },\n    [\n      item,\n      handleCloseQueryContainer,\n      updateValue,\n      parentType,\n      successAction,\n      createValue,\n    ]\n  );\n\n  const formOptions = useMemo(\n    () =>\n      item\n        ? {\n            valuesForEdit: item,\n            onSubmitMethod: onSubmitInputs,\n            loading,\n          }\n        : {\n            initialValues,\n            onSubmitMethod: onSubmitInputs,\n          },\n    [initialValues, item, loading, onSubmitInputs]\n  );\n\n  const { handleSubmit, setFieldValue, formValues, formHandler } =\n    useForm(formOptions);\n\n  // Handle dynamical fields for some forms\n  useEffect(() => {\n    prepareDynamicalFieldsByFormType({\n      parentType,\n      dynamicalInputs,\n      formHandler,\n      formValues,\n      item,\n    });\n  }, [parentType, formValues, dynamicalInputs, item]);\n\n  const parsedValues = useMemo(\n    () =>\n      Object.keys(formValues).map((field) => ({\n        field,\n        value: formValues[field],\n      })),\n    [formValues]\n  );\n\n  const arrayOfValues = useMemo(\n    () =>\n      parsedValues\n        .filter((pvFilter) => !DISABLED_IDS.includes(pvFilter.field))\n        .map((pv) =>\n          customizeFieldInputs({ pv, parentType, item, externalValues })\n        ),\n    [parsedValues, parentType, item, externalValues]\n  ) as FieldsType[];\n\n  const handleChangeField = useCallback(\n    (value: string | number | boolean, field: string) => {\n      setFieldValue(field, value);\n    },\n    [setFieldValue]\n  );\n\n  const submitLocale = useMemo(\n    () => (item ? saveLabel : createLabel),\n    [item, saveLabel, createLabel]\n  );\n\n  return {\n    loading: createLoading || updateLoading,\n    handleSubmit,\n    arrayOfValues,\n    handleChangeField,\n    submitLocale,\n  };\n};\n\nexport default useResourceInputsQueryForm;\n"],"mappings":"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"}