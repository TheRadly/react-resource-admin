{"version":3,"file":"useResourceInputsQueryForm.js","names":["_react","require","_useForm","_interopRequireDefault","_config","_lodash","obj","__esModule","default","useResourceInputsQueryForm","_ref","extraFormCruds","item","handleCloseQueryContainer","filterItems","initialValues","createQuery","updateQuery","id","loading","saveLabel","createLabel","parentType","useMemo","createValue","createLoading","updateValue","updateLoading","onSubmitInputs","useCallback","val","console","log","variables","input","update","formOptions","valuesForEdit","onSubmitMethod","handleSubmit","setFieldValue","formValues","formHandler","useForm","useEffect","LOYALTY_LEVEL","type","LOYALTY_LEVEL_REWARD_TYPES","BONUS","has","BONUS_ID","bonusId","undefined","CASHBACK","CASHBACK_PERCENT","cashbackPercent","DEPOSIT_LIMIT","depositLimit","WITHDRAW_LIMIT","withdrawLimit","parsedValues","Object","keys","map","field","value","arrayOfValues","pv","TYPE","_dropdownTypeValues$f","dropdownTypeValues","LoyaltyRewardTypeEnums","key","name","code","activeValue","find","toString","isFloat","LOYALITY_LEVEL_ID","isDisabled","handleChangeField","submitLocale","_default","exports"],"sources":["../../../../src/resources/ResourceInputsForm/talons/useResourceInputsQueryForm.ts"],"sourcesContent":["import { useCallback, useEffect, useMemo } from \"react\";\nimport type { CrudType } from \"../models/CrudType\";\nimport { FieldsType } from \"../models/FieldsType\";\nimport useForm from \"../../ResourceForm/talons/useForm\";\nimport {\n  BONUS_ID,\n  CASHBACK_PERCENT,\n  DEPOSIT_LIMIT,\n  LOYALITY_LEVEL_ID,\n  LOYALTY_LEVEL,\n  LOYALTY_LEVEL_REWARD_TYPES,\n  LoyaltyRewardTypeEnums,\n  TYPE,\n  WITHDRAW_LIMIT,\n} from \"../config\";\nimport { has } from \"lodash\";\n\ninterface UseResourceInputsQueryForm {\n  extraFormCruds: CrudType;\n  item?: any;\n  handleCloseQueryContainer?: () => void;\n  filterItems?: FieldsType[];\n}\n\nconst useResourceInputsQueryForm = ({\n  extraFormCruds,\n  item,\n  handleCloseQueryContainer,\n  filterItems,\n}: UseResourceInputsQueryForm) => {\n  const {\n    initialValues,\n    createQuery,\n    updateQuery,\n    id,\n    loading,\n    saveLabel,\n    createLabel,\n    parentType,\n  } = useMemo(() => extraFormCruds || {}, [extraFormCruds]);\n\n  const [createValue, { loading: createLoading }] = createQuery();\n  const [updateValue, { loading: updateLoading }] = updateQuery();\n\n  const onSubmitInputs = useCallback(\n    (val: any) => {\n      console.log(val);\n      if (item) {\n        updateValue({\n          variables: {\n            input: {\n              id,\n              update: {\n                ...val,\n              },\n            },\n          },\n        });\n      } else {\n        createValue({\n          variables: {\n            input: val,\n          },\n        });\n      }\n\n      if (handleCloseQueryContainer) {\n        handleCloseQueryContainer();\n      }\n    },\n    [updateValue, createValue, item, id, handleCloseQueryContainer]\n  );\n\n  const formOptions = useMemo(\n    () =>\n      item\n        ? {\n            valuesForEdit: item,\n            onSubmitMethod: onSubmitInputs,\n            loading,\n          }\n        : {\n            initialValues,\n            onSubmitMethod: onSubmitInputs,\n          },\n    [initialValues, item, loading, onSubmitInputs]\n  );\n\n  const { handleSubmit, setFieldValue, formValues, formHandler } =\n    useForm(formOptions);\n\n  useEffect(() => {\n    if (parentType && parentType === LOYALTY_LEVEL) {\n      if (\n        formValues?.type === LOYALTY_LEVEL_REWARD_TYPES.BONUS &&\n        !has(formValues, BONUS_ID)\n      ) {\n        formHandler.setFieldValue(BONUS_ID, item?.bonusId || \"\");\n      } else if (\n        formValues?.type !== LOYALTY_LEVEL_REWARD_TYPES.BONUS &&\n        has(formValues, BONUS_ID)\n      ) {\n        formHandler.setFieldValue(BONUS_ID, undefined);\n      }\n\n      if (\n        formValues?.type === LOYALTY_LEVEL_REWARD_TYPES.CASHBACK &&\n        !has(formValues, CASHBACK_PERCENT)\n      ) {\n        formHandler.setFieldValue(\n          CASHBACK_PERCENT,\n          item?.cashbackPercent || \"\"\n        );\n      } else if (\n        formValues?.type !== LOYALTY_LEVEL_REWARD_TYPES.CASHBACK &&\n        has(formValues, CASHBACK_PERCENT)\n      ) {\n        formHandler.setFieldValue(CASHBACK_PERCENT, undefined);\n      }\n\n      if (\n        formValues?.type === LOYALTY_LEVEL_REWARD_TYPES.DEPOSIT_LIMIT &&\n        !has(formValues, DEPOSIT_LIMIT)\n      ) {\n        formHandler.setFieldValue(DEPOSIT_LIMIT, item?.depositLimit || \"\");\n      } else if (\n        formValues?.type !== LOYALTY_LEVEL_REWARD_TYPES.DEPOSIT_LIMIT &&\n        has(formValues, DEPOSIT_LIMIT)\n      ) {\n        formHandler.setFieldValue(DEPOSIT_LIMIT, undefined);\n      }\n\n      if (\n        formValues?.type === LOYALTY_LEVEL_REWARD_TYPES.WITHDRAW_LIMIT &&\n        !has(formValues, WITHDRAW_LIMIT)\n      ) {\n        formHandler.setFieldValue(WITHDRAW_LIMIT, item?.withdrawLimit || \"\");\n      } else if (\n        formValues?.type !== LOYALTY_LEVEL_REWARD_TYPES.WITHDRAW_LIMIT &&\n        has(formValues, WITHDRAW_LIMIT)\n      ) {\n        formHandler.setFieldValue(WITHDRAW_LIMIT, undefined);\n      }\n    }\n  }, [\n    parentType,\n    formValues,\n    item?.bonusId,\n    item?.cashbackPercent,\n    item?.depositLimit,\n    item?.withdrawLimit,\n  ]);\n\n  const parsedValues = useMemo(\n    () =>\n      Object.keys(formValues).map((field) => ({\n        field,\n        value: formValues[field],\n      })),\n    [formValues]\n  );\n\n  const arrayOfValues = useMemo(\n    () =>\n      parsedValues.map((pv) => {\n        if (parentType === LOYALTY_LEVEL) {\n          if (pv.field === TYPE) {\n            const dropdownTypeValues = Object.keys(LoyaltyRewardTypeEnums).map(\n              (key) => ({\n                name: key,\n                // @ts-ignore\n                code: LoyaltyRewardTypeEnums[key],\n              })\n            );\n\n            return {\n              ...pv,\n              ...(item\n                ? {\n                    activeValue: {\n                      // @ts-ignore\n                      name: dropdownTypeValues.find(\n                        (value) => value.code === pv.value\n                      )?.name,\n                      code: pv.value,\n                    },\n                  }\n                : null),\n              value: dropdownTypeValues,\n            };\n          } else if (\n            pv.field === CASHBACK_PERCENT ||\n            pv.field === DEPOSIT_LIMIT ||\n            pv.field === WITHDRAW_LIMIT\n          ) {\n            return {\n              ...pv,\n              value:\n                typeof pv.value === \"string\" ? pv.value : pv.value.toString(),\n              isFloat: true,\n            };\n          } else if (pv.field === LOYALITY_LEVEL_ID) {\n            return {\n              ...item,\n              isDisabled: true,\n            };\n          }\n        }\n\n        return pv;\n      }),\n    [parsedValues, parentType, item]\n  ) as FieldsType[];\n\n  const handleChangeField = useCallback(\n    (value: string | number | boolean, field: string) => {\n      setFieldValue(field, value);\n    },\n    [setFieldValue]\n  );\n\n  const submitLocale = useMemo(\n    () => (item ? saveLabel : createLabel),\n    [item, saveLabel, createLabel]\n  );\n\n  return {\n    loading: createLoading || updateLoading,\n    handleSubmit,\n    arrayOfValues,\n    handleChangeField,\n    submitLocale,\n  };\n};\n\nexport default useResourceInputsQueryForm;\n"],"mappings":"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"}