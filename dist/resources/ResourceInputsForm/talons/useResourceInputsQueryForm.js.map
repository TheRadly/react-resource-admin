{"version":3,"file":"useResourceInputsQueryForm.js","names":["_react","require","_useForm","_interopRequireDefault","_config","_helpers","_lodash","obj","__esModule","default","defaultRefetchVariables","input","pagination","page","limit","useResourceInputsQueryForm","_ref","extraFormCruds","item","handleCloseQueryContainer","saveLabel","createLabel","initialValues","dynamicalInputs","createQuery","updateQuery","id","loading","parentType","refetchDocument","useMemo","queryOptions","refetchQueries","query","variables","createValue","createLoading","updateValue","updateLoading","onSubmitInputs","useCallback","val","data","removeExtraFormItemId","getCorrectExtraFormSubmitValues","formOptions","valuesForEdit","onSubmitMethod","handleSubmit","setFieldValue","formValues","formHandler","useForm","useEffect","LOYALTY_LEVEL","type","selectedDynamicalInput","find","dynamicalInput","forEach","inputs","currentInput","has","undefined","parsedValues","Object","keys","map","field","value","arrayOfValues","pv","TYPE","_dropdownTypeValues$f","dropdownTypeValues","LoyaltyRewardTypeEnums","key","name","code","activeValue","CASHBACK_PERCENT","DEPOSIT_LIMIT","WITHDRAW_LIMIT","_pv$value","isFloat","toString","LOYALTY_LEVEL_ID","isDisabled","handleChangeField","submitLocale","_default","exports"],"sources":["../../../../src/resources/ResourceInputsForm/talons/useResourceInputsQueryForm.ts"],"sourcesContent":["import { useCallback, useEffect, useMemo } from \"react\";\nimport type { CrudType } from \"../models/CrudType\";\nimport { FieldsType } from \"../models/FieldsType\";\nimport useForm from \"../../ResourceForm/talons/useForm\";\nimport {\n  CASHBACK_PERCENT,\n  DEPOSIT_LIMIT,\n  LOYALTY_LEVEL_ID,\n  LOYALTY_LEVEL,\n  LoyaltyRewardTypeEnums,\n  TYPE,\n  WITHDRAW_LIMIT,\n} from \"../config\";\nimport {\n  getCorrectExtraFormSubmitValues,\n  removeExtraFormItemId,\n} from \"../helpers\";\nimport { has } from \"lodash\";\n\ninterface UseResourceInputsQueryForm {\n  extraFormCruds: CrudType;\n  item?: any;\n  handleCloseQueryContainer?: () => void;\n  saveLabel?: string;\n  createLabel?: string;\n}\n\nconst defaultRefetchVariables = {\n  input: {\n    pagination: {\n      page: 0,\n      limit: 10,\n    },\n  },\n};\n\nconst useResourceInputsQueryForm = ({\n  extraFormCruds,\n  item,\n  handleCloseQueryContainer,\n  saveLabel,\n  createLabel,\n}: UseResourceInputsQueryForm) => {\n  const {\n    initialValues,\n    dynamicalInputs,\n    createQuery,\n    updateQuery,\n    id,\n    loading,\n    parentType,\n    refetchDocument,\n  } = useMemo(() => extraFormCruds || {}, [extraFormCruds]);\n\n  const queryOptions = refetchDocument\n    ? {\n        refetchQueries: [\n          { query: refetchDocument, variables: defaultRefetchVariables },\n        ],\n      }\n    : null;\n\n  const [createValue, { loading: createLoading }] = createQuery(queryOptions);\n  const [updateValue, { loading: updateLoading }] = updateQuery(queryOptions);\n\n  const onSubmitInputs = useCallback(\n    (val: any) => {\n      if (item) {\n        updateValue({\n          variables: {\n            input: {\n              id: item?.id,\n              data: removeExtraFormItemId(\n                getCorrectExtraFormSubmitValues(val, parentType),\n                parentType\n              ),\n            },\n          },\n        });\n      } else {\n        createValue({\n          variables: {\n            input: getCorrectExtraFormSubmitValues(val, parentType),\n          },\n        });\n      }\n\n      if (handleCloseQueryContainer) {\n        handleCloseQueryContainer();\n      }\n    },\n    [updateValue, createValue, item, id, handleCloseQueryContainer, parentType]\n  );\n\n  const formOptions = useMemo(\n    () =>\n      item\n        ? {\n            valuesForEdit: item,\n            onSubmitMethod: onSubmitInputs,\n            loading,\n          }\n        : {\n            initialValues,\n            onSubmitMethod: onSubmitInputs,\n          },\n    [initialValues, item, loading, onSubmitInputs]\n  );\n\n  const { handleSubmit, setFieldValue, formValues, formHandler } =\n    useForm(formOptions);\n\n  useEffect(() => {\n    if (parentType && parentType === LOYALTY_LEVEL && dynamicalInputs) {\n      if (formValues?.type !== \"\") {\n        const selectedDynamicalInput = dynamicalInputs.find(\n          (dynamicalInput: { type: string; inputs: string[] }) =>\n            dynamicalInput.type === formValues?.type\n        );\n\n        if (selectedDynamicalInput) {\n          dynamicalInputs.forEach(\n            (dynamicalInput: { type: string; inputs: string[] }) => {\n              if (dynamicalInput.type !== formValues?.type) {\n                dynamicalInput.inputs.forEach((currentInput) => {\n                  if (has(formValues, currentInput)) {\n                    formHandler.setFieldValue(currentInput, undefined);\n                  }\n                });\n              }\n            }\n          );\n\n          selectedDynamicalInput?.inputs.forEach((input: string) => {\n            if (!has(formValues, input)) {\n              formHandler.setFieldValue(input, item?.[input] || \"\");\n            }\n          });\n        }\n      }\n    }\n  }, [parentType, formValues, dynamicalInputs, item]);\n\n  const parsedValues = useMemo(\n    () =>\n      Object.keys(formValues).map((field) => ({\n        field,\n        value: formValues[field],\n      })),\n    [formValues]\n  );\n\n  const arrayOfValues = useMemo(\n    () =>\n      parsedValues.map((pv) => {\n        if (parentType === LOYALTY_LEVEL) {\n          if (pv.field === TYPE) {\n            const dropdownTypeValues = Object.keys(LoyaltyRewardTypeEnums).map(\n              (key) => ({\n                name: key,\n                // @ts-ignore\n                code: LoyaltyRewardTypeEnums[key],\n              })\n            );\n\n            return {\n              ...pv,\n              ...(item\n                ? {\n                    activeValue: {\n                      // @ts-ignore\n                      name: dropdownTypeValues.find(\n                        (value) => value.code === pv.value\n                      )?.name,\n                      code: pv.value,\n                    },\n                  }\n                : null),\n              value: dropdownTypeValues,\n            };\n          } else if (\n            pv.field === CASHBACK_PERCENT ||\n            pv.field === DEPOSIT_LIMIT ||\n            pv.field === WITHDRAW_LIMIT\n          ) {\n            return item\n              ? {\n                  ...pv,\n                  isFloat: true,\n                  value:\n                    typeof pv.value === \"string\"\n                      ? pv.value\n                      : pv.value?.toString() || \"\",\n                }\n              : {\n                  ...pv,\n                  isFloat: true,\n                };\n          } else if (pv.field === LOYALTY_LEVEL_ID) {\n            return {\n              ...item,\n              isDisabled: true,\n            };\n          }\n        }\n\n        return pv;\n      }),\n    [parsedValues, parentType, item]\n  ) as FieldsType[];\n\n  const handleChangeField = useCallback(\n    (value: string | number | boolean, field: string) => {\n      setFieldValue(field, value);\n    },\n    [setFieldValue]\n  );\n\n  const submitLocale = useMemo(\n    () => (item ? saveLabel : createLabel),\n    [item, saveLabel, createLabel]\n  );\n\n  return {\n    loading: createLoading || updateLoading,\n    handleSubmit,\n    arrayOfValues,\n    handleChangeField,\n    submitLocale,\n  };\n};\n\nexport default useResourceInputsQueryForm;\n"],"mappings":"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"}